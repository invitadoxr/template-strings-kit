function _array_like_to_array(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function asyncGeneratorStep(e,t,n,r,a,s,i){try{var o=e[s](i),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function _async_to_generator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){asyncGeneratorStep(s,r,a,i,o,"next",e)}function o(e){asyncGeneratorStep(s,r,a,i,o,"throw",e)}i(void 0)}))}}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _unsupported_iterable_to_array(e,t){if(e){if("string"==typeof e)return _array_like_to_array(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_array_like_to_array(e,t):void 0}}function _ts_generator(e,t){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}var vscode=require("vscode"),fs=require("fs"),path=require("path"),swc=require("@swc/core");function readDirAsync(e){return _readDirAsync.apply(this,arguments)}function _readDirAsync(){return _readDirAsync=_async_to_generator((function(e){var t,n,r,a,s=arguments;return _ts_generator(this,(function(i){switch(i.label){case 0:t=s.length>1&&void 0!==s[1]&&s[1],n=s.length>2&&void 0!==s[2]&&s[2],r=null,i.label=1;case 1:return i.trys.push([1,4,,8]),[4,fs.promises.stat(e)];case 2:if(i.sent().isFile())throw new Error("readDirAsync. dirpath is a file");return[4,fs.promises.readdir(e)];case 3:return r=i.sent(),[3,8];case 4:return a=i.sent(),n&&(r=[]),"ENOENT"===a.code&&t?[4,fs.promises.mkdir(e)]:[3,7];case 5:return i.sent(),[4,fs.promises.readdir(e)];case 6:r=i.sent(),i.label=7;case 7:if(!Array.isArray(r))throw a;return[3,8];case 8:return[2,r]}}))})),_readDirAsync.apply(this,arguments)}function readFileAsync(e){return _readFileAsync.apply(this,arguments)}function _readFileAsync(){return _readFileAsync=_async_to_generator((function(e){var t,n,r,a,s,i=arguments;return _ts_generator(this,(function(o){switch(o.label){case 0:t=i.length>1&&void 0!==i[1]&&i[1],n=i.length>2&&void 0!==i[2]?i[2]:"",r=i.length>3&&void 0!==i[3]&&i[3],a=null,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,fs.promises.readFile(e,"utf-8")];case 2:return a=o.sent(),[3,7];case 3:return s=o.sent(),r&&(a=""),"ENOENT"==s.code&&t?[4,fs.promises.writeFile(e,n,"utf-8")]:[3,6];case 4:return o.sent(),[4,fs.promises.readFile(e,"utf-8")];case 5:a=o.sent(),o.label=6;case 6:if("string"!=typeof a)throw s;return[3,7];case 7:return[2,a]}}))})),_readFileAsync.apply(this,arguments)}function getStoreDirPathAsync(e){return _getStoreDirPathAsync.apply(this,arguments)}function _getStoreDirPathAsync(){return _getStoreDirPathAsync=_async_to_generator((function(e){var t,n,r=arguments;return _ts_generator(this,(function(a){switch(a.label){case 0:return t=r.length>1&&void 0!==r[1]&&r[1],[4,readDirAsync(n=path.normalize(e.globalStorageUri.fsPath),t)];case 1:return a.sent(),[2,n]}}))})),_getStoreDirPathAsync.apply(this,arguments)}function writeFileAsync(e,t){return _writeFileAsync.apply(this,arguments)}function _writeFileAsync(){return _writeFileAsync=_async_to_generator((function(e,t){var n,r,a=arguments;return _ts_generator(this,(function(s){switch(s.label){case 0:n=a.length>2&&void 0!==a[2]&&a[2],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fs.promises.writeFile(e,t,"utf-8")];case 2:return s.sent(),[3,4];case 3:if(r=s.sent(),!n)throw r;return[3,4];case 4:return[2]}}))})),_writeFileAsync.apply(this,arguments)}function getTemplateStringInfoAsync(e,t,n){return _getTemplateStringInfoAsync.apply(this,arguments)}function _getTemplateStringInfoAsync(){return(_getTemplateStringInfoAsync=_async_to_generator((function(e,t,n){return _ts_generator(this,(function(r){return[2,new Promise((function(r,a){try{var s=new vscode.Position(0,0),i={content:"",relativePosition:s,isInside:!1,language:"",range:new vscode.Range(s,s)},o=e.getText(),c=e.offsetAt(t),l=_to_consumable_array(o.substring(0,c).matchAll(n)).pop(),u=l[1];"html5"!=u&&"htmx"!=u&&"html"!=u||(u="html"),"style"!=u&&"stylesheet"!=u&&"css"!=u||(u="css"),"jsx"==u&&(u="jsx"),i.language="html"!=u&&"css"!=u&&"jsx"!=u?"":u;var p=l.index,h=l.index+l[0].length,g=e.positionAt(p),_=e.positionAt(h),d=new vscode.Range(g,_);i.range=d;var f=o.substring(h),y=f.indexOf("`");if((-1===y||c<=h+y)&&(i.isInside=!0),!i.language||!i.isInside)return r(i);var m=c-h,v=f.substring(0,m).split("\n"),w=new vscode.Position(v.length-1,v[v.length-1].length),b=f.substring(0,y);return i.content=b,i.relativePosition=w,r(i)}catch(e){return a(new Error("Error on getTemplateStringInfoAsync, ".concat(e)))}}))]}))}))).apply(this,arguments)}function getCompletionListFromFilePathAsync(e,t,n){return _getCompletionListFromFilePathAsync.apply(this,arguments)}function _getCompletionListFromFilePathAsync(){return(_getCompletionListFromFilePathAsync=_async_to_generator((function(e,t,n){var r,a,s,i;return _ts_generator(this,(function(o){switch(o.label){case 0:return r=vscode.Uri.file(e),a=t.split("\n").length-1,s=t.split("\n").pop().length,i=new vscode.Position(a,s),n&&(i=n),[4,vscode.commands.executeCommand("vscode.executeCompletionItemProvider",r,i,"")];case 1:return[2,o.sent()]}}))}))).apply(this,arguments)}function completionItemsExpliciter(e){return e.map((function(e){var t=new vscode.CompletionItem(e.label,e.kind);return t.insertText=e.insertText,t.documentation=e.documentation,t.detail=e.detail,t}))}function getCurrentInfo(){var e=vscode.window.activeTextEditor,t=e.document,n=e.selection.active,r=t.offsetAt(n);return{currentEditor:e,currentTextDocument:t,currentPosition:n,currentOffset:r}}function createJsxDiagnosticFromContentInRange(e,t,n,r){return _createJsxDiagnosticFromContentInRange.apply(this,arguments)}function _createJsxDiagnosticFromContentInRange(){return(_createJsxDiagnosticFromContentInRange=_async_to_generator((function(e,t,n,r){var a,s,i,o,c,l,u,p;return _ts_generator(this,(function(h){switch(h.label){case 0:e.clear(),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,swc.transform(n,{jsc:{parser:{syntax:"ecmascript",jsx:!0}}})];case 2:return h.sent(),[3,4];case 3:return a=h.sent(),s=strExtractLineColumn(a.message),i=s.line,o=s.column,c=createDiagnosticFromError(a),l=new vscode.Position(r.start.line+i-1,r.start.character+o),u=new vscode.Position(r.start.line+i-1,r.start.character+o),p=new vscode.Range(l,u),c.range=p,e.set(t.uri,[c]),[3,4];case 4:return[2]}}))}))).apply(this,arguments)}function strExtractLineColumn(e){var t=["-1"],n=-1,r=-1;return(!(t=e.match(/line\s*:?\s*(\d*),?\s*column\s*:?\s*(\d*)/im))||(n=parseInt(t[2],10),r=parseInt(t[3],10),isNaN(n)||isNaN(r)))&&(!(t=e.match(/invalid character (["']?.*?["']?) at (\d+):(\d+)/im))||(n=parseInt(t[2],10),r=parseInt(t[3],10),isNaN(n)||isNaN(r)))&&(!(t=e.match(/\[(\d+):(\d+)\]/im))||(n=parseInt(t[1],10),r=parseInt(t[2],10),isNaN(n)||isNaN(r)))?{line:-1,column:-1}:{line:n,column:r}}function createDiagnosticFromError(e){var t=strExtractLineColumn(e.message),n=t.line,r=t.column;-1!==n&&-1!==r||(n=1,r=1);var a=new vscode.Range(new vscode.Position(n-1,r),new vscode.Position(n-1,r));return new vscode.Diagnostic(a,e.message,vscode.DiagnosticSeverity.Error)}function createStatusBarItem(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vscode.StatusBarAlignment.Left,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=vscode.window.createStatusBarItem(a,s);return i.command=e,i.text=t,i.tooltip=r,n?i.show():i.hide(),i}var diagColl=vscode.languages.createDiagnosticCollection("jsx");function activate(e){return _activate.apply(this,arguments)}function _activate(){return _activate=_async_to_generator((function(e){var t,n,r,a,s,i,o,c,l,u;return _ts_generator(this,(function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,getStoreDirPathAsync(e,!0)];case 1:return t=p.sent(),n=path.join(t,"html-emmet-provider.html"),readFileAsync(r=path.normalize(n),!0),a=path.join(t,"css-emmet-provider.css"),readFileAsync(s=path.normalize(a),!0),i=path.join(t,"jsx-emmet-provider.jsx"),readFileAsync(o=path.normalize(i),!0),c=/\/\*\s*(html|htmx|html5|css|style|stylesheet|jsx)\s*\*\/\s*`/g,e.subscriptions.push(diagColl),vscode.workspace.onDidChangeTextDocument((h=_async_to_generator((function(e){var t,n,a,i,l,u,p,h;return _ts_generator(this,(function(g){switch(g.label){case 0:return t=vscode.window.activeTextEditor,n=e.document,a=t.selection.active,"javascript"!==n.languageId||t.document!==n?[2,null]:[4,getTemplateStringInfoAsync(n,a,c)];case 1:return i=g.sent(),l=i.content,u=i.isInside,i.relativePosition,p=i.language,h=i.range,u?[4,writeFileAsync("html"===p?r:"jsx"===p?o:s,l)]:[2,null];case 2:return g.sent(),"jsx"!==p?[2,null]:[4,createJsxDiagnosticFromContentInRange(diagColl,n,l,h)];case 3:return g.sent(),[2]}}))})),function(e){return h.apply(this,arguments)})),l=vscode.languages.registerCompletionItemProvider({scheme:"file",language:"javascript"},{provideCompletionItems:function(e,t,n,a){return _async_to_generator((function(){var n,a,i,l,u,p;return _ts_generator(this,(function(h){switch(h.label){case 0:return[4,getTemplateStringInfoAsync(e,t,c)];case 1:return n=h.sent(),a=n.content,i=n.isInside,l=n.relativePosition,u=n.language,n.range,i?[4,getCompletionListFromFilePathAsync("html"===u?r:"jsx"===u?o:s,a,l)]:[2,null];case 2:return 0===(p=h.sent()).items.length?(console.error("Erx. completionList. cannot reach hints"),[2,null]):[2,completionItemsExpliciter(p.items)]}}))}))()}},""),e.subscriptions.push(l),[3,3];case 2:return u=p.sent(),console.error("Erx. General. ",u),[3,3];case 3:return[2]}var h}))})),_activate.apply(this,arguments)}function deactivate(){}module.exports={activate,deactivate};